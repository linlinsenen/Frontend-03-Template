- ### HTML 解析

  - 创建parser.js文件用于单独处理HTML解析逻辑
- 将上一周中返回的response body返回给parser用于解析
  - 利用有限状态机去实现HTML的分析
- HTML标签解析：开始标签，结束标签和自关闭标签
  - 在状态机中加入业务逻辑：创建token 并在标签结束状态提交token
- 在处理HTML标签属性值时需考虑到属性值分为单引号，双引号和无引号三种写法，需要多状态处理
  - 处理属性的方式跟标签类似，在属性结束时需要把属性添加到标签的token上
- 使用栈来构建DOM树
  - 开始标签入栈，遇到结束标签出栈，自封闭节点入栈后立刻出栈
  - 任何元素的父元素都是它入栈前的栈顶
  - 处理文本节点与自封闭标签类似，多个文本节点需要合并
  
  ### CSS Computing
  
  -  遇到style标签时需要把css规则保存起来
  - 调用css parser来分析css规则
  - 我们是一次性获取style标签内容，在真是浏览器中需注意body中也可能存在style标签
  - 在计算css规则时，需要知道元素的所有父元素才能判断元素与规则是否匹配
  - 首先获取的是当前元素，获得和计算父元素的匹配顺序是从内向外
  - 选择器也要从当前元素向外排列
- 复杂选择器拆成针对单个元素的选择器，用循环匹配父元素队列
  - 根据选择器的类型和元素属性，计算是否与当前元素匹配
- 一旦选择匹配就把选择器应用到元素上，形成computedStyle
  - css 规则根据specificity和后来优先规则覆盖
- specificity是四元组，越左权重越高
  - 一个css规则的specificity根据包含的简单选择器相加得出
